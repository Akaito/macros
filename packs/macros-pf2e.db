{"name":"Treat Wounds","permission":{"default":0,"y5gmtwxmW3A5ZuOP":3},"type":"script","flags":{},"scope":"global","command":"/* This is a script that automates the Treat Wounds or Battle Medicine skill. It returns 3 (or 2) chat messages:\n    1. A shout-out\n    2. The result of the medicine check\n    3. The result according to the degree of succes of the medicine check (no message if the check is a failure)\n  \n  You can use key combinations for different DC's, which will also add the bonus healing corresponding to that DC. \n  The key combinations are:\n    - normal click for Trained DC\n    - ctrl-click for Expert DC\n    - alt-click for Master DC\n    - ctrl-alt-click for Legendary DC\n  For example, if you use ctrl-click, you will roll a med check for the Expert DC (20) and, if you will succed, you will add a bonus healing of 10 to the 2d8 roll.\n  \n  For this to work, you need to have your character token selected.\n*/\n\n\n// Variables used for different DC's\n\nlet bonusheal = 0;\nlet dc_text = \" - Trained DC (15)\";\nlet dc_value = 0;\n\n\n// Flavor text that will be displayed in the chat box. You can change the text according to your own will, be creative and have fun!\n\nlet Shoutout_flavor_msg = \"I will try to heal you!\";\nlet Success_flavor_msg = \"Success!\";\nlet CritSuccess_flavor_msg = \"Outstanding Success!\";\nlet Failure_flavor_msg = \"Failure...\";\nlet CritFailure_flavor_msg = \"Or maybe... I'll be the one to kill you\";\nlet Heal_flavor_msg = \"You shall heal for:\";\nlet Dmg_flavor_msg = \"You will take this damage:\";\n\n\n// Here the DC variables will be changed according to which key combinations you use\n\nif(event.ctrlKey && event.altKey == true) {\n  bonusheal = 50;\n  dc_text = \" - Legendary DC (40)\";\n  dc_value = 25;\n} else if(event.ctrlKey) {\n  bonusheal = 10;\n  dc_text = \" - Expert DC (20)\";\n  dc_value = 5;\n} else if(event.altKey) {\n  bonusheal = 30;\n  dc_text = \" - Master DC (30)\";\n  dc_value = 15;\n}\n\n\n// Declaring the dice rolls\n\nlet r1 = new Roll(\"1d20+@skills.med.value\", token.actor.getRollData());\nlet r2 = new Roll('2d8+@bonusheal', {bonusheal});\nlet r3 = new Roll('4d8+@bonusheal', {bonusheal});\nlet r4 = new Roll(\"1d8\");\n\n\n// Shout-out your intention to heal\n\nChatMessage.create({content: Shoutout_flavor_msg+dc_text, speaker: ChatMessage.getSpeaker({actor: actor})});\n\n\n// Rolling the medicine check\n\nr1.roll();\nlet a = r1.total;\n\n\n// Comparing the medicine check with the DC and returning the corresponding result\n\nif(a>14+dc_value) { \n  if(a-token.actor.data.data.skills.med.value==1) {\n    if (a-10>14+dc_value) {\n      r1.toMessage({\n        flavor: Success_flavor_msg,\n        speaker: ChatMessage.getSpeaker({token: token}),\n      });\n      r2.roll();\n      r2.toMessage({\n        flavor: Heal_flavor_msg,\n        speaker: ChatMessage.getSpeaker({token: token}),\n      });\n    } else {\n      r1.toMessage({\n        flavor: Failure_flavor_msg,\n        speaker: ChatMessage.getSpeaker({token: token}),\n       });\n      }\n  } else if(a-10>14+dc_value || a-token.actor.data.data.skills.med.value == 20) { \n      r1.toMessage({\n        flavor: CritSuccess_flavor_msg,\n        speaker: ChatMessage.getSpeaker({token: token}),\n      });\n      r3.roll();\n      r3.toMessage({\n        flavor: Heal_flavor_msg,\n        speaker: ChatMessage.getSpeaker({token: token}),\n      });\n  } else {\n        r1.toMessage({\n          flavor: Success_flavor_msg,\n          speaker: ChatMessage.getSpeaker({token: token}),\n        });\n        r2.roll();\n        r2.toMessage({\n          flavor: Heal_flavor_msg,\n          speaker: ChatMessage.getSpeaker({token: token}),\n        });\n      }\n} else if(a<15+dc_value) {\n    if (a+10<15+dc_value || a-token.actor.data.data.skills.med.value==1) {\n      r1.toMessage({\n        flavor: CritFailure_flavor_msg,\n        speaker: ChatMessage.getSpeaker({token: token}),\n      });\n      r4.roll();\n      r4.toMessage({\n        flavor: Dmg_flavor_msg,\n        speaker: ChatMessage.getSpeaker({token: token}),\n      });\n    } else {\n         r1.toMessage({\n          flavor: Failure_flavor_msg,\n          speaker: ChatMessage.getSpeaker({token: token}),\n         });\n        }\n}\n","author":"y5gmtwxmW3A5ZuOP","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"kkJ2nNIr9kHoxmIX"}
